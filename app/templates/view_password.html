{% extends "base.html" %}
{% block content %}
<h2>View Password</h2>

<div class="card shadow-sm">
    <div class="card-body">
        <h5 class="card-title">{{ password_entry.service_name }}</h5>
        <p><strong>Login:</strong> {{ password_entry.login_name }}</p>
        <p><strong>URL:</strong> <a href="{{ password_entry.url }}" target="_blank">{{ password_entry.url }}</a></p>
        <p><strong>Notes:</strong> {{ password_entry.notes }}</p>
        <hr>
        <p>
            <strong>Decrypted Password:</strong> 
            <span id="password-text" style="letter-spacing:2px;">********</span>
            
            <button class="btn btn-sm btn-outline-secondary" onclick="togglePassword()">Show/Hide</button>
            <button class="btn btn-sm btn-outline-primary" onclick="copyPassword()">Copy</button>
        </p>
    </div>
</div>

<a href="{{ url_for('routes.dashboard') }}" class="btn btn-primary mt-3">Back to Dashboard</a>

<script>
function togglePassword() {
    const el = document.getElementById("password-text");
    if (el.innerText === "********") {
        el.innerText = "{{ actual_password }}";
    } else {
        el.innerText = "********";
    }
}

function copyPassword(passwordId) {
    const el = document.getElementById("password-text");
    let textToCopy = el.innerText === "********" ? "{{ actual_password }}" : el.innerText;

    navigator.clipboard.writeText(textToCopy).then(() => {
        alert("Password copied to clipboard!");

        // Log to server
        fetch(`/copy_password/${passwordId}`, {
            method: "POST"
        });
    }).catch(err => {
        console.error("Failed to copy password:", err);
        alert("Could not copy password.");
    });
}

</script>
{% endblock %}
